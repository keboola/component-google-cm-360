{
  "title": "DM360 Report",
  "type": "object",
  "required": [
    "input_variant",
    "time_range",
    "destination"
  ],
  "properties": {
    "profiles": {
      "type": "array",
      "title": "Profiles",
      "propertyOrder": 50,
      "description": "Select profiles to be used in reporting",
      "items": {
        "type": "string",
        "enum": [],
        "minLength": 1,
        "title": "Profiles"
      },
      "format": "select",
      "uniqueItems": true,
      "options": {
        "async": {
          "label": "Load avaiable profiles",
          "action": "load_profiles"
        }
      }
    },
    "input_variant": {
      "type": "string",
      "title": "Report specification mode",
      "propertyOrder": 100,
      "description": "You may choose to either define a new report or to enter existing report ID",
      "enum": [
        "report_specification",
        "report_template_id",
        "existing_report_ids"
      ],
      "options": {
        "enum_titles": [
          "Report specification",
          "Report template",
          "Existing report ID(s)"
        ]
      },
      "default": "report_specification"
    },
    "time_range": {
      "type": "object",
      "title": "Time Range",
      "propertyOrder": 450,
      "properties": {
        "period": {
          "type": "string",
          "title": "Report Period",
          "propertyOrder": 10,
          "default": "LAST_7_DAYS",
          "enum": [
            "CUSTOM_DATES",
            "TODAY",
            "YESTERDAY",
            "WEEK_TO_DATE",
            "MONTH_TO_DATE",
            "QUARTER_TO_DATE",
            "YEAR_TO_DATE",
            "PREVIOUS_WEEK",
            "PREVIOUS_MONTH",
            "PREVIOUS_QUARTER",
            "PREVIOUS_YEAR",
            "LAST_7_DAYS",
            "LAST_30_DAYS",
            "LAST_90_DAYS",
            "LAST_365_DAYS",
            "LAST_24_MONTHS",
            "LAST_14_DAYS",
            "LAST_60_DAYS"
          ],
          "options": {
            "enum_titles": [
              "Custom date range",
              "Today",
              "Yesterday",
              "All days, including the current day, since the most recent Sunday",
              "All days, including the current day, since the start of the current month",
              "All days, including the current day, since the start of the current quarter",
              "All days, including the current day, since the start of the current calendar year",
              "The previous completed week, beginning from Sunday",
              "The previous completed calendar month",
              "The previous completed quarter",
              "The previous completed calendar year",
              "The previous 7 days, excluding the current day",
              "The previous 30 days, excluding the current day",
              "The previous 90 days, excluding the current day",
              "The previous 365 days, excluding the current day",
              "The previous 24 months",
              "The previous 14 days, excluding the current day",
              "The previous 60 days, excluding the current day"
            ]
          }
        },
        "date_from": {
          "type": "string",
          "title": "Date from",
          "propertyOrder": 20,
          "description": "Start date: Either date in YYYY-MM-DD format or a relative date string i.e. 5 days ago, 1 month ago, yesterday, etc.",
          "options": {
            "dependencies": {
              "period": "CUSTOM_DATES"
            }
          }
        },
        "date_to": {
          "type": "string",
          "title": "Date to",
          "propertyOrder": 30,
          "description": "End date: Either date in YYYY-MM-DD format or a relative date string i.e. 5 days ago, 1 month ago, yesterday, etc.",
          "options": {
            "dependencies": {
              "period": "CUSTOM_DATES"
            }
          }
        }
      },
      "options": {
        "dependencies": {
          "input_variant": ["report_specification", "report_template_id"]
        }
      }
    },
    "report_specification": {
      "type": "object",
      "title": "Report Details",
      "propertyOrder": 300,
      "properties": {
        "report_type": {
          "title": "Report Type",
          "type": "string",
          "enum": [
            "STANDARD",
            "REACH",
            "FLOODLIGHT",
            "PATH",
            "PATH_ATTRIBUTION"
          ],
          "options": {
            "enum_titles": [
              "Standard",
              "Reach",
              "Floodlight",
              "Path",
              "Path Attribution"
            ]
          },
          "propertyOrder": 500
        },
        "dimensions": {
          "options": {
            "async": {
              "label": "Load available dimensions",
              "action": "load_dimensions"
            }
          },
          "title": "Dimensions",
          "type": "array",
          "format": "select",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": [],
            "minLength": 1,
            "title": "Dimensions"
          },
          "propertyOrder": 600
        },
        "metrics": {
          "options": {
            "async": {
              "label": "Load available metrics",
              "action": "load_metrics"
            }
          },
          "type": "array",
          "title": "Metrics",
          "format": "select",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": [],
            "minLength": 1,
            "title": "Metrics"
          },
          "propertyOrder": 700
        }
      },
      "options": {
        "dependencies": {
          "input_variant": "report_specification"
        }
      }
    },
    "report_template_id": {
      "type": "string",
      "title": "Report ID as a Template",
      "propertyOrder": 350,
      "minLength": 1,
      "description": "Select a report that becomes a template for all profiles",
      "enum": [],
      "options": {
        "dependencies": {
          "input_variant": "report_template_id"
        },
        "async": {
          "label": "Load available reports",
          "action": "load_reports"
        }
      }
    },
    "existing_report_ids": {
      "type": "array",
      "title": "Report ID(s) to be run in parallel",
      "propertyOrder": 400,
      "minLength": 1,
      "description": "Select reports that will run in parallel",
      "format": "select",
      "uniqueItems": true,
      "items": {
        "title": "Report ID",
        "type": "string",
        "enum": [],
        "minLength": 1
      },
      "options": {
        "dependencies": {
          "input_variant": "existing_report_ids"
        },
        "async": {
          "label": "Load available reports",
          "action": "load_reports"
        }
      }
    },
    "destination": {
      "type": "object",
      "title": "Destination",
      "propertyOrder": 600,
      "required": [
        "table_name",
        "incremental_loading"
      ],
      "properties": {
        "selected_variant": {
          "type": "string",
          "title": "Selected variant",
          "description": "Helper dummy element to render pkeys",
          "template": "{{var}}",
          "watch": {
            "var": "input_variant"
          },
          "options": {
            "hidden": true
          }
        },
        "table_name": {
          "type": "string",
          "title": "Storage Table Name",
          "propertyOrder": 10,
          "minLength": 1,
          "description": "Name of the destination table for this report. (e.g. standard_performance_data)."
        },
        "primary_key": {
          "type": "array",
          "title": "Primary Key",
          "description": "List of columns (from selected dimensions) to be used as primary key of the resulting table. We recommend using ID columns where possible, to avoid ambiguity in case the dimension name is changed.",
          "propertyOrder": 20,
          "format": "select",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "watch": {
              "dim": "report_specification.dimensions"
            },
            "enumSource": "dim"
          },
          "options": {
            "dependencies": {
              "selected_variant": "report_specification"
            }
          }
        },
        "primary_key_existing": {
          "type": "array",
          "title": "Primary Key",
          "description": "List of columns (load from report) to be used as primary key of the resulting table. We recommend using ID columns where possible, to avoid ambiguity in case the dimension name is changed.",
          "propertyOrder": 21,
          "format": "select",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": [],
            "minLength": 1,
            "title": "Dimension"
          },
          "options": {
            "async": {
              "label": "Load available dimensions",
              "action": "list_report_dimensions"
            },
            "dependencies": {
              "selected_variant": ["report_template_id", "existing_report_ids"]
            }
          }
        },
        "incremental_loading": {
          "enum": [
            false,
            true
          ],
          "type": "boolean",
          "title": "Load Type",
          "default": true,
          "options": {
            "enum_titles": [
              "Full Load",
              "Incremental Load"
            ]
          },
          "description": "If Full load is used, the destination table will be overwritten every run. If Incremental Load is used, data will be upserted into the destination table.",
          "propertyOrder": 30
        }
      }
    }
  }
}